##
# this is a default config file for a simple python site
##

<% if node[:nginx][:ssl][:enabled] %>
ssl_certificate       <%= node[:nginx][:ssl][:certificate] %>;
ssl_certificate_key   <%= node[:nginx][:ssl][:certificate_key] %>;
<% end %>

#server {
#  listen  80;
#  server_name *.localhost;
#  rewrite ^ $scheme://<%= node[:nginx][:server_name] %>$request_uri permanent;
#}

server {

  # address a bug in Virtualbox and shared folders
  # http://serverfault.com/questions/269420/
  sendfile off;

  listen  80;
  <% if node[:nginx][:ssl][:enabled] %>
  listen  443 default_server ssl;
  <% end %>

  charset utf-8;
  server_name <%= node[:nginx][:server_name] %>;
  root <%= node[:nginx][:root] %>;

  access_log /var/log/nginx/access.log;
  error_log /var/log/nginx/error.log;

  try_files $uri @python;

  # pass the python scripts to USGI server listening on a socket (eg 127.0.0.1:9001)
  location @python {
    include uwsgi_params;
    uwsgi_param HTTP_X_FORWARDED_PROTOCOL $scheme;
    uwsgi_pass <%= node[:nginx][:socket] %>;
    # uwsgi_pass unix:///path/to/socket;
  }

  # deny access to .htaccess files
  location ~ /\.ht {
    deny all;
  }

}
